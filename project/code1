int inputPin = D2;              // PIR Sensor PIN number
int ledPin = D7;                // LED PIN number
int pirState = LOW;             // The initial value is the state in which no motion is detected.
int val = 0;                    // Variables for reading the pin status.

int calibrateTime = 10000;      // Time taken to calibrate the sensor (milliseconds)

void setup()
{
  pinMode(ledPin, OUTPUT);
  pinMode(inputPin, INPUT);
}

void loop()
{
  if (calibrated()) {
    readTheSensor();
    reportTheData();
  }
}

void readTheSensor() {
  val = digitalRead(inputPin);
}

bool calibrated() {
  return millis() - calibrateTime > 0;
}

void reportTheData() {
  if (val == HIGH) {
    if (pirState == LOW) {
      // Processing is only performed if the sensor changes to an operational state.
      Particle.publish("designingiot/s19/motion");
      pirState = HIGH;
      setLED(pirState);
    }
  } else {
    if (pirState == HIGH) {
      // Processing is only performed if the sensor changes to a non-operational state.
      pirState = LOW;
      setLED(pirState);
    }
  }
}


void setLED(int state) {
  digitalWrite(ledPin, state);
}
