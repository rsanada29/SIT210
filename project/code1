int inputPin = D2;              // PIRセンサーのピン番号
int ledPin = D7;                // LEDのピン番号
int pirState = LOW;             // モーションが検出されていない状態を初期値とする
int val = 0;                    // ピンの状態を読み取るための変数

int calibrateTime = 10000;      // センサーのキャリブレーションにかかる時間（ミリ秒）

void setup()
{
  pinMode(ledPin, OUTPUT);
  pinMode(inputPin, INPUT);
}

void loop()
{
  if (calibrated()) {
    readTheSensor();
    reportTheData();
  }
}

void readTheSensor() {
  val = digitalRead(inputPin);
}

bool calibrated() {
  return millis() - calibrateTime > 0;
}

void reportTheData() {
  if (val == HIGH) {
    if (pirState == LOW) {
      // センサーが動作状態に変化した場合のみ処理を実行
      Particle.publish("designingiot/s19/motion");
      pirState = HIGH;
      setLED(pirState);
    }
  } else {
    if (pirState == HIGH) {
      // センサーが非動作状態に変化した場合のみ処理を実行
      pirState = LOW;
      setLED(pirState);
    }
  }
}


void setLED(int state) {
  digitalWrite(ledPin, state);
}
